------------------------------------------INICIO---------------------------------------------------
select
dc2.CPF as cpf,
fi.id_cliente  as telefone,
CASE
	when fi.produto = 'Não informado' then null
	else fi.produto
end as produto,
case
	when fi.pediu_cpf = 'NA' then convert(varchar(30),dc2.CPF)
	when fi.pediu_cpf = 'Não Informado' then  convert(varchar(30),dc2.CPF)
	else fi.pediu_cpf
end as idcob_contrato,
case
	when fi.erro_api = 'NA' then id_cliente 
	when fi.erro_api = 'Não Informado' then id_cliente 
	else fi.erro_api
end as idcob_telefone,
fi.dt_inicial as data_hora_acionamento,
null as duracao,
CASE 
	when fi.ult_ocorrencia = '' then '2000'
	when fi.ult_ocorrencia is null then '2000'
	when fi.ult_ocorrencia = 'TRANSFERIDO PARA WHATSAPP' then '2000'
	when fi.ult_ocorrencia = 'DIREC AGENCIA' then '2000'
	when fi.ult_ocorrencia = 'RECLAMAÇAO' then '2000'
	when fi.ult_ocorrencia = 'TESTE' then '2000'
	when fi.ult_ocorrencia = 'CONTATO_CENTRAL' then '2000'
	when fi.ult_ocorrencia = 'ACORDO_AVISTA_1' then '3001'
	when fi.ult_ocorrencia = 'ACORDO_PARCEL_2' then '3001'
	when fi.ult_ocorrencia = 'ACORDO_PARCEL_3' then '3001'
	when fi.ult_ocorrencia = 'ACORDO_AVISTA' then '3001'
	when fi.ult_ocorrencia = 'ACORDO_PARCEL' then '3001'
	when fi.ult_ocorrencia = 'ALEGA_PGTO' then '3002'
	when fi.ult_ocorrencia = 'ALEG02' then '3002'
	when fi.ult_ocorrencia = 'ALEG03' then '3002'
	when fi.ult_ocorrencia = 'ALEG01' then '3002'
	when fi.ult_ocorrencia = 'RECADO' then '3003'
	when fi.ult_ocorrencia = 'DESCONHECE' then '3003'
	when fi.ult_ocorrencia = 'FALECIDO' then '3003'
	when fi.ult_ocorrencia = 'NAO_RECONHECE' then '3004'
	when fi.ult_ocorrencia = 'ENVIAR_BOLETO' then '3005'
	when fi.ult_ocorrencia = 'PEDIU_BOLETO' then '3005'
	when fi.ult_ocorrencia = 'PROMPGTO' then '3006'
	when fi.ult_ocorrencia = 'EM_NEG' then '3006'
	when fi.ult_ocorrencia = 'OFERTA_3' then '3006'
	when fi.ult_ocorrencia = 'OFERTA_2' then '3006'
	when fi.ult_ocorrencia = 'OFERTA_1' then '3006'
	when fi.ult_ocorrencia = 'MAIS_PRAZO' then '3006'
	when fi.ult_ocorrencia = 'SEM_OFERTAS' then '3006'
	when fi.ult_ocorrencia = 'APRESENTA_DÍVIDA' then '3006'
	when fi.ult_ocorrencia = 'APRESENTA_DIVIDA' then '3006'
	when fi.ult_ocorrencia = 'BC_NOVA_FILA' then '3009'
	when fi.ult_ocorrencia = 'CONFIRMA_SER' then '3011'
	when fi.ult_ocorrencia = 'CPF_NAO_CONFERE' then '3011'
	when fi.ult_ocorrencia = 'NAO_CONFIRMA_DADOS' then '3011'
	when fi.ult_ocorrencia = 'ACORDO' then '3001'
	when fi.ult_ocorrencia = 'EM_NEGOCIAÇÃO' then '3006'
	when fi.ult_ocorrencia = 'NAO_CLIENTE' then '3012'
	when fi.ult_ocorrencia = 'SMS ENVIADO' then '3100'
	when fi.ult_ocorrencia = 'EMAIL ENVIADO' then '3101'
	when fi.ult_ocorrencia = 'DIGITAL - ACORDO REALIZADO' then '2001'
	when fi.ult_ocorrencia = 'DIGITAL - BOLETO PAGO' then '2020'
	when fi.ult_ocorrencia = 'DIGITAL - DESCONHECE A DIVIDA' then '2021'
	when fi.ult_ocorrencia = 'DIGITAL - CONTATO COM TERCEIRO' then '2022'
	when fi.ult_ocorrencia = 'DIGITAL - CLIENTE ALEGA PAGAMENTO' then '2023'
	when fi.ult_ocorrencia = 'DIGITAL - CLIENTE FALECIDO' then '2024'
	when fi.ult_ocorrencia = 'DIGITAL - COMPROVANTE' then '2025'
	when fi.ult_ocorrencia = 'DIGITAL - DESCONHECE CLIENTE' then '2026'
	when fi.ult_ocorrencia = 'DIGITAL - DIREC AGÊNCDIGITAL' then '2027'
	when fi.ult_ocorrencia = 'DIGITAL - DUVIDAS' then '2028'
	when fi.ult_ocorrencia = 'DIGITAL - GEROU ACORDO DISCADOR' then '2029'
	when fi.ult_ocorrencia = 'DIGITAL - RECLAMAÇÃO' then '2030'
	when fi.ult_ocorrencia = 'DIGITAL - REENVIO BOLETO/OPERAÇÃO' then '2031'
	when fi.ult_ocorrencia = 'DIGITAL-  SEM CONDIÇÕES' then '2032'
	when fi.ult_ocorrencia = 'DIGITAL - SEM INTERESSE' then '2033'
	when fi.ult_ocorrencia = 'DIGITAL - BAIXADO' then '2034'
	when fi.ult_ocorrencia = 'DIGITAL - DIREC AGÊNCIA' then '2027'
	when fi.ult_ocorrencia = 'DIGITAL - RECUSA CONFIRMAR CPF/NOME' then '2035'
	else '2000'
END as id_tabulacao,
CASE 
	when fi.ult_ocorrencia is null then 'SEM OCORRENCIA DEFINIDA'
	when fi.ult_ocorrencia = '' then 'SEM OCORRENCIA DEFINIDA'
	ELSE fi.ult_ocorrencia
end AS historico_tag05,
fi.valor_da_opcao_escolhida as valor_parcela_acordo,
CASE
	when fi.ult_ocorrencia = 'ACORDO_AVISTA' then '1'
	when fi.ult_ocorrencia = 'ACORDO_AVISTA_1' then '1'
	else fi.dado_informado
end as quantidade_parcelas_acordo,
fi.valor_com_desconto  as valor_desconto_acordo,
fi.data_vencimento as data_vencimento,
fi.funil as funil_tag01
from FAT_IA fi
left join DIM_CPF dc2  on fi.id_cpf = dc2.id 
where format(fi.dt_inicial, 'yyyy-MM-dd') = DATEADD(day, -1, convert(date, GETDATE()))
UNION
select
dc.CPF as cpf,
fi.id_cliente as telefone,
CASE
	when fi.produto = 'Não informado' then null
	else fi.produto
end as produto,
CASE 
	when fi.pediu_cpf = 'NA' then convert(varchar(30),dc.CPF)
	when fi.pediu_cpf = 'Não Informado' then  convert(varchar(30),dc.CPF)
	else fi.pediu_cpf
end as idcob_contrato,
case
	when fi.erro_api = 'NA' then fi.id_cliente 
	when fi.erro_api = 'Não Informado' then fi.id_cliente
	else fi.erro_api
end as idcob_telefone,
ft.DT_PRIMEIRA_MENSAGEM  as data_hora_acionamento,
CONVERT(varchar,Convert(Time,DateAdd(SECOND,ft.TMA,'00:00:00')),108) as duracao,
case
	when ft.TAGS = 'ACORDO REALIZADO' then '2001'
	when ft.TAGS = 'BOLETO PAGO' then '2020'
	when ft.TAGS = 'DESCONHECE A DIVIDA' then '2021'
	when ft.TAGS = 'CONTATO COM TERCEIRO' then '2022'
	when ft.TAGS = 'CLIENTE ALEGA PAGAMENTO' then '2023'
	when ft.TAGS = 'CLIENTE FALECIDO' then '2024'
	when ft.TAGS = 'COMPROVANTE' then '2025'
	when ft.TAGS = 'DESCONHECE CLIENTE' then '2026'
	when ft.TAGS = 'DIREC AGÊNCDIGITAL' then '2027'
	when ft.TAGS = 'DUVIDAS' then '2028'
	when ft.TAGS = 'GEROU ACORDO DISCADOR' then '2029'
	when ft.TAGS = 'RECLAMAÇÃO' then '2030'
	when ft.TAGS = 'REENVIO BOLETO/OPERAÇÃO' then '2031'
	when ft.TAGS = 'DIGITAL-  SEM CONDIÇÕES' then '2032'
	when ft.TAGS = 'SEM INTERESSE' then '2033'
	when ft.TAGS = 'BAIXADO' then '2034'
	when ft.TAGS = 'DIREC AGÊNCIA' then '2027'
	when ft.TAGS = 'RECUSA CONFIRMAR CPF/NOME' then '2035'
end as id_tabulacao,
ft.TAGS as historico_tag05,
null as valor_parcela_acordo,
null as quantidade_parcelas_acordo,
null as valor_desconto_acordo,
null as data_vencimento,
null as funil
from FAT_TRANSBORDO ft
left join FAT_IA fi on ft.ID_CPF = fi.id_cpf
left join DIM_CPF  dc on ft.ID_CPF  = dc.id
where format(ft.DT_PRIMEIRA_MENSAGEM , 'yyyy-MM-dd') = DATEADD(day, -1, convert(date, GETDATE()))
------------------------------------------FIM---------------------------------------------------
